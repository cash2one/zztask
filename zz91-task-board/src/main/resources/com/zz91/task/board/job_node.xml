<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="jobNode">

	<typeAlias alias="jobNode" type="com.zz91.task.board.domain.JobNode"/>

	<resultMap id="defaultResult" class="jobNode">
		<result property="id" column="id"/>
		<result property="nodeKey" column="node_key"/>
		<result property="remark" column="remark"/>
		<result property="status" column="status"/>
		<result property="gmtCreated" column="gmt_created"/>
		<result property="gmtModified" column="gmt_modified"/>
	</resultMap>
	
	<insert id="insertNode" parameterClass="jobNode" >
		INSERT INTO `job_node` (`node_key`, `remark`, `status`, `gmt_created`, `gmt_modified`) 
		VALUES (#nodeKey#, #remark#, #status#, now(), now())
		<selectKey resultClass="java.lang.Integer" keyProperty="id" >
      		SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>
	
	<update id="updateNode" parameterClass="java.util.HashMap" >
	    update job_node set
	    	`remark` = #remark#, 
	    	`status` = #status#,
	    	gmt_modified=now()
	    where id=#id#
	</update>
	
	<sql id="defaultColumn" >
		id, node_key, remark, status, gmt_created, gmt_modified
	</sql>
	
	<sql id="defaultDynamic">
		<dynamic prepend="where">
			<isNotEmpty property="nodeKey">
				node_key=#nodeKey#
			</isNotEmpty>
		</dynamic>
	</sql>
	
	<select id="queryDefault" parameterClass="java.util.HashMap" 
		resultMap="defaultResult">
		select
			<include refid="defaultColumn" />
		from `job_node`
			<include refid="defaultDynamic" />
		limit 500
	</select>
	
</sqlMap>		
 