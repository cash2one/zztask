<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="jobNodeRunning">

	<typeAlias alias="jobNodeRunning" type="com.zz91.task.board.domain.JobNodeRunning"/>

	<resultMap id="defaultResult" class="jobNodeRunning">
		<result property="id" column="id"/>
		<result property="nodeKey" column="node_key"/>
		<result property="jobId" column="job_id"/>
		<result property="gmtCreated" column="gmt_created"/>
		<result property="gmtModified" column="gmt_modified"/>
	</resultMap>
	
	<insert id="insertNodeRunning" parameterClass="jobNodeRunning" >
		INSERT INTO `job_node_running` (`node_key`, `job_id`, `gmt_created`, `gmt_modified`) 
		VALUES (#nodeKey#, #jobId#, now(), now())
		<selectKey resultClass="java.lang.Integer" keyProperty="id" >
      		SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>
	
	<delete id="deleteByJob" parameterClass="java.util.HashMap" >
		delete from job_node_running 
		where job_id=#jobId# and node_key=#nodeKey#
	</delete>
	
	<select id="queryByNode" parameterClass="java.lang.String" 
		resultClass="java.lang.String">
		select
			job_id
		from `job_node_running`
		where node_key=#nodeKey#
		limit 1000
	</select>
	
</sqlMap>		
 